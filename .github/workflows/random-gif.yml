name: Random GIF in README

on:
  schedule:
    - cron: "0 */6 * * *" # Executa a cada 6 horas
  workflow_dispatch: # Permite rodar manualmente

jobs:
  update-gif:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Definir próximo GIF
        run: |
          # Lista de GIFs
          GIFS=("https://media.tenor.com/zZ2o8_ONLlRAAAA/jojo-fortnite.gif" \
                "https://media.tenor.com/9qvRhTR47joAAAAS/shadow-dio-jjba.gif" \
                "https://media.tenor.com/zVj0tqzt_MAAAC/touhou-sakuya-floss.gif")

          # Arquivo que salva o índice do último GIF usado
          INDEX_FILE=".github/workflows/last_gif_index.txt"

          # Se o arquivo não existir, começamos do 0
          if [ ! -f "$INDEX_FILE" ]; then
            echo "0" > "$INDEX_FILE"
          fi

          # Lê o índice atual
          INDEX=$(cat "$INDEX_FILE")

          # Calcula o próximo índice (0 → 1 → 2 → 0 → 1 → 2 ...)
          NEXT_INDEX=$(( (INDEX + 1) % ${#GIFS[@]} ))

          # Salva o próximo índice para a próxima execução
          echo "$NEXT_INDEX" > "$INDEX_FILE"

          # Define o GIF escolhido
          RANDOM_GIF=${GIFS[$NEXT_INDEX]}
          echo "GIF_ESCOLHIDO=$RANDOM_GIF" >> $GITHUB_ENV

      - name: Atualizar README com o GIF escolhido
        run: |
          sed -i "s|<img src=\"https://.*\" height=\"160\" style=\"margin-bottom: 10px;\" />|<img src=\"$GIF_ESCOLHIDO\" height=\"160\" style=\"margin-bottom: 10px;\" />|" README.md

      - name: Commit e Push das alterações
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add README.md .github/workflows/last_gif_index.txt
          git commit -m "Atualizando GIF do README"
          git push
